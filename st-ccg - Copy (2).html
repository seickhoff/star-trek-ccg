<html>

<head>

	<style>
		body {
			background-image: url("star-space-tile.jpg");
			background-repeat: repeat-y repeat-x;
			background-color: black;
		}
		td {
			vertical-align: top;
			text-align: center;
			padding: 10px;
		}

		.full {
			width: 357px;
			height: 497px;
		}
		.thumb {
			width: 180px;
			height: 250px;	
			text-align: top;
		}
		/* rotate 180 */
		td.oppenent, td.thumb {
			filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2); 
		}
		/* rotate another 180 */
		.oppenent .full {
			width: 357px;
			height: 497px;
			filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2);
		}
		.mission {
			background-color:rgba(255,0,0,0.15);
		}
		.personnel {
			background-color:rgba(0,0,255,0.15);
		}		
		.summary {
			background-color: #cccccc;;
		}		
	</style>

	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="js/cards.js"></script>

	<script>
	

		// A $( document ).ready() block
		$( document ).ready(function() {		
		
			// borg deck
			playerFullDeck = ["EN03110", "EN03094", "EN03103", "EN03082", "EN03083", // missions
				"EN03118", "EN03118", "EN03118", "EN03122", "EN03122", "EN03124", "EN03124", // personnel
				"EN03125", "EN03125", "EN03126", "EN03126", "EN03130", "EN03130", "EN03131", "EN03131", 
				"EN03134", "EN03134", "EN03137", "EN03137", "EN03139", "EN03140", "EN03140"
			]; 
			
			playerFullDeck = shuffle(playerFullDeck);
			
			playerMissions = [];
			playerDilemmas = [];
			playerDeck = [];
			
			// parse deck into missions/dilemmas/reserve
			$.each(playerFullDeck, function(index, value) {
				if (cardDb[value].type == "Mission")
					playerMissions.push(value);
				else if (cardDb[value].type == "Dilemma")
					playerDilemmas.push(value);
				else (cardDb[value].type == "Mission")
					playerDeck.push(value);					

			});			
				
			// cards on missions
			played = new Array();
			played[1] = [];
			played[2] = [];
			played[3] = [];
			played[4] = [];
			played[5] = [];
			
			// missions
			col = 0;
			$.each(playerMissions, function(index, value) {
				if (cardDb[value].type == "Mission") { // [array] notation when property is a variable
					col++;
					// select matching multiple classes
					$("td.mission.c" + col).html("<img class='thumb' src='" + cardDb[value].jpg + "'>");
				}
			});
			
			// personnel
			col = 0;
			$.each(playerDeck, function(index, value) {
				if (cardDb[value].type == "Personnel") { // [array] notation when property is a variable
					col++;
					col = 1;
					played[col].push(value);
					// select matching multiple classes
					$("td.personnel.c" + col).append("<img class='thumb' src='" + cardDb[value].jpg + "'> ");
				}
			});			
			
			// summary
			$.each(played, function(index, value) {
				if (index > 0 && index <= 5) {
					strength = 0;
					integrity = 0;
					cunning = 0;
					cnt = 0;
					var skills = { };
					$.each(value, function(index, id) {
						strength += cardDb[id].strength;
						integrity += cardDb[id].integrity;
						cunning += cardDb[id].cunning;
						cnt++;
						
						// skills
						$.each(cardDb[id].skills, function(i, v) {
							$.each(v, function(i2, v2) {
								skills[v2] = skills[v2] + 1 || 1; // Increment counter for each value
							
							});
						});
					});	
					
					skillList = joinSkills(skills); // join
									
					if (cnt > 0) {
						$("td.summary.c" + index).html("Personnel: " + cnt);					
						$("td.summary.c" + index).append(", Integrity: " + integrity);
						$("td.summary.c" + index).append(", Cunning: " + cunning);
						$("td.summary.c" + index).append(", Strength: " + strength);
						$("td.summary.c" + index).append(", " + skillList);
					}
					else {
						$("td.summary.c" + index).html("Personnel: " + cnt);					
					}
				}
			});	


			// toggle thumbnail / full
			$("img").click(
				function() {  
					if ($(this).is(".thumb")) 
						$(this).attr("class","full");
					else
						$(this).attr("class","thumb");
				}
			); 

			//$("td.mission.c2").html('<p>All new content. <em>You bet!</em></p>');
				
		});	
	
		//var cardDb = Array();
		
		//$('.two, .three').css('background','yellow');


		//$('div.out').html('<p>All new content. <em>You bet!</em></p>');

		/* 
			Basicially an advanced Join function
		*/
		function joinSkills(skills) {
			var arr = [];
			$.each(skills, function(i, v) {
				arr.push(i + ": " + v);
			});	
			arr.sort();
			return arr.join(", ");
		}
		


    function shuffle (arr) {
        for(var j, x, i = arr.length; i; j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x);
        return arr;
    }

	
	
	</script>
</head>

<body>

<table border="0" align="center" width="100%">
	<tr>
		<td class="oppenent mission c1">1
		<td class="oppenent mission c2">2
		<td class="oppenent mission c3">3
		<td class="oppenent mission c4">4
		<td class="oppenent mission c5">5
	</tr>
	<tr>
		<td class="player mission c1">1
		<td class="player mission c2">2
		<td class="player mission c3">3
		<td class="player mission c4">4
		<td class="player mission c5">5
	</tr>
	<tr>
		<td class="player summary c1">1
		<td class="player summary c2">2
		<td class="player summary c3">3
		<td class="player summary c4">4
		<td class="player summary c5">5
	</tr>		
	<tr>
		<td class="player personnel c1">1
		<td class="player personnel c2">2
		<td class="player personnel c3">3
		<td class="player personnel c4">4
		<td class="player personnel c5">5
	</tr>	
</table>


<div id="missions" style="text-align: top;"></div>	
<div id="personnel"></div>	

</body>

</html>